وحدة آلة.الإعراب.الافتراضية

باستخدام "stack"
فصيلة معرب:
    له بيان، موقع
    له مكدس، مكدس.قيم
    له رسالة.خطأ
    يستجيب ل: ادفع.مسار.بديل(العلامة)، تقدم()، تقدم.عديد(ن)، تجاهل.آخر.مسار.بديل()
    يرد على اذهب.مسار.بديل()، منته()، انظر()، انظر.عديد(ن)، يطل.على(ن)، يطل.على.عديد(ن)، الجأ.لبديل()، تفرع(العلامة، علامة.العودة)، عد()
   يستجيب ل: اطرش()
   يستجيب ل: ادفع.المتغيرات.المحلية(ن)
   يرد على ارفع.المتغيرات.المحلية()
نهاية

دالة صنع.معرب(البيان):
    م = معرب جديد
    بيان م = البيان
    موقع م = 1
    مكدس م = صنع.مكدس()
	مكدس.قيم م = صنع.مكدس()
    ارجع ب: م
نهاية

استجابة معرب م ل: اطرش():
    اطبع "البيان:"
    اطبع بيان م
    لكل أ من 1 إلى موقع م - 1 :
        اطبع " "،...
    تابع
    اطبع "*"
    اطبع "الموقع="، موقع م
    ( مكدس م) : اطرش()
نهاية
رد معرب م على تفرع(العلامة،علامة.العودة):
    ك = مكدس م
    ك : ادفع(علامة.العودة)
    ارجع ب: العلامة
نهاية

رد معرب م على عد():
    ك = مكدس م
    ارجع ب: ك: ارفع()
نهاية

رد معرب م1 على منته():
    ارجع ب: موقع م1 > عدد(بيان م1)
نهاية

رد معرب م على انظر():
    ارجع ب: (بيان م)[موقع م]
نهاية

رد معرب م على انظر.عديد(ن):
	ب = بيان م
	ع = موقع م
	إذا ب هو نص:
		ارجع ب: وسط(ب، ع، ن)
	وإلا إذا ب هو مصفوفة.قيم:
		ر = []
		لكل أ من ع إلى ع + ن - 1 :
			ر = ر + [ ب[أ] ]
		تابع
		ارجع ب: ر
	تم
	ارجع ب: لاشيء
نهاية

رد معرب م على يطل.على(ن):
	إذا م:منته() :
		ارجع ب: خطأ
	تم
	ارجع ب:  ن = م : انظر()
نهاية

رد معرب م على يطل.على.عديد(ن):
    إذا (عدد(ن) + موقع م - 1) > عدد(بيان م) :
        ارجع ب: خطأ
    تم
    لكل أ من 1 إلى عدد(ن):
        ز = أ + موقع م - 1
        إذا ليس ن[أ] = (بيان م)[ز] :
            ارجع ب: خطأ
        تم
    تابع
    ارجع ب: صحيح
نهاية

استجابة معرب م ل: تقدم():
    موقع م = موقع م + 1
نهاية

استجابة معرب م ل: تقدم.عديد(ن):
    موقع م = موقع م + ن
نهاية


استجابة معرب م4 ل: ادفع.مسار.بديل(العلامة):
    (مكدس م4): ادفع([العلامة، موقع م4])
نهاية

استجابة معرب م ل: تجاهل.آخر.مسار.بديل():
    ر = (مكدس م) : ارفع()
    إذا ليس ر ~ [؟أ، ؟ب]:
        اطبع "تجاهل آخر مسار بديل: قمة المكدس ("، ر،") ليست نقطة تراجع"
        م: اطرش()
    تم
نهاية

رد معرب م6 على الجأ.لبديل():
	ك = مكدس م6
	طالما ليس ك : فارغ() ولا ك: انظر() ~ [؟أ، ؟ب]:
		مم = ك: ارفع()
                    مم = (مكدس.قيم م6) : ارفع()
           --          اطبع "رفعت "، مم، " من على المكدس"
	تابع
	إذا ك: فارغ():
              رسالة.خطأ م6 = "الجأ لبديل: قمة المكدس فارغة بعد حذف اي علامات عادية"
              ارجع ب: "%خطأ.في.الإعراب"
	تم
	مم = ك: انظر()
	إذا مم ~ [؟العلامة، ؟الموقع] :
                     مم = ك:ارفع()
		موقع م6 = الموقع
		ارجع ب: العلامة
          وإلا:
               رسالة.خطأ م6 = "الجأ لبديل: قمة المكدس هي " + كنص(مم) + "وليس [علامة، مكان]"
              ارجع ب: "%خطأ.في.الإعراب"
	تم
نهاية

رد معرب م على اذهب.مسار.بديل():
    ر = (مكدس م) : ارفع()
    إذا ر ~ [؟العلامة، ؟الموقع]:
        موقع م = الموقع
        ارجع ب: العلامة
    تم
    رسالة.خطأ م = "محاولة الذهاب لمسار بديل، لكن قمة المكدس هي" + كنص(ر)
    ارجع ب: "%خطأ.في.الإعراب"
نهاية
استجابة معرب م ل: ادفع.المتغيرات.المحلية(ن):
	(مكدس.قيم م) : ادفع(ن)
نهاية

رد معرب م على ارفع.المتغيرات.المحلية():
	ارجع ب: (مكدس.قيم م): ارفع()
نهاية